{% extends "base.html" %}
{% block content %}

<link rel="stylesheet" href="../static/pivot/lib/css/pivot.css" type="text/css" />
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>

<!--Pivot Bootstrap-->
<link rel="stylesheet" href="../static/bootstrap.min.css" type="text/css" />
<link rel="stylesheet" href="../static/pivot/lib/css/subnav.css" type="text/css" />
<link rel="stylesheet" href="../static/pivot/lib/css/pivot.css" type="text/css" />

<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script type="text/javascript" src="../static/pivot/lib/javascripts/subnav.js"></script>
<script type="text/javascript" src="../static/pivot/lib/javascripts/accounting.min.js"></script>
<script type="text/javascript" src="../static/pivot/lib/javascripts/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="../static/pivot/lib/javascripts/dataTables.bootstrap.js"></script>


<!-- jquery_pivot must be loaded after pivot.js and jQuery -->
<script type="text/javascript" src="../static/pivot/pivot.js"></script>
<script type="text/javascript" src="../static/pivot/jquery_pivot.js"></script>
<script type="text/javascript">
  $(document).ready(function () {
    var reportDict = {{ FullReportJson|safe }};
    var report = reportDict.report;
    console.log(report);
    var missing = reportDict.missing;
    var exceptions = reportDict.exceptions;
    
    fields = [
      { name: 'ID', type: 'integer', filterable: false },
      { name: 'Object Type', type: 'string', filterable: false },
      { name: 'Name', type: 'string', filterable: false },
      { name: 'Fiscal Year', type: 'integer', filterable: false },
      { name: 'Data in Project(GB)', type: 'integer', rowLabelable: false },
      { name: 'Data per File (KB)', type: 'string', filterable: false },
      { name: 'Fiscal Year Total Data (GB)', type: 'integer', filterable: false },
      { name: 'Running Data Total(GB)', type: 'integer', filterable: false }
        ];
    $('#pivot-menu-container').pivot_display('setup', { json: report, fields: fields });
  });
</script>
<div>
  <div class="container">
    <h1>Pivot.js</h1>
    <p>Pivot.js is a simple way to summarize large data sets on the fly. On this page we are using the pivot jQuery plugin which
      offers a nice entry point to Pivot.js.
      <br/>
      <br/> The data for the chart below is based on a CSV file of about 5000 rows. It is generated by a
      <a href="https://github.com/rjackson/pivot.js/blob/master/demo_csv_builder.rb">script</a> included in the repository. It is designed to have many fields that have at least some significant relationships
      between one another. This only just scratches the surface of what Pivot.js can do. Check out the
      <a href="https://github.com/rjackson/pivot.js/blob/master/README.md">README</a> for more information. Also feel free to run the spec (found in the link up top), and if you spot any problems
      let us know so we can fix them.
      <br/>
      <br/>
      <b>To begin:</b>
      <ul>
        <li>Select the fields you would like to display from the Label Fields/Summary Fields drop down.</li>
        <li>Then filter your data by selecting from the filters drop down.</li>
        <li>Ta-da, you have yourself a custom report!</li>
      </ul>
    </p>
    <div class="subnav">
      <ul class="nav nav-pills">
        <li class="dropdown">
          <a class="dropdown-toggle" data-toggle="dropdown" href="#">
            Filter Fields
            <b class="caret"></b>
          </a>
          <ul class="dropdown-menu stop-propagation" style="overflow:auto;max-height:450px;padding:10px;">
            <div id="filter-list"></div>
          </ul>
        </li>
        <li class="dropdown">
          <a class="dropdown-toggle" data-toggle="dropdown" href="#">
            Row Label Fields
            <b class="caret"></b>
          </a>
          <ul class="dropdown-menu stop-propagation" style="overflow:auto;max-height:450px;padding:10px;">
            <div id="row-label-fields"></div>
          </ul>
        </li>
        <li class="dropdown">
          <a class="dropdown-toggle" data-toggle="dropdown" href="#">
            Column Label Fields
            <b class="caret"></b>
          </a>
          <ul class="dropdown-menu stop-propagation" style="overflow:auto;max-height:450px;padding:10px;">
            <div id="column-label-fields"></div>
          </ul>
        </li>
        <li class="dropdown">
          <a class="dropdown-toggle" data-toggle="dropdown" href="#">
            Summary Fields
            <b class="caret"></b>
          </a>
          <ul class="dropdown-menu stop-propagation" style="overflow:auto;max-height:450px;padding:10px;">
            <div id="summary-fields"></div>
          </ul>
        </li>
        <li class="dropdown pull-right">
          <a class="dropdown-toggle" data-toggle="dropdown" href="#">
            Canned Reports
            <b class="caret"></b>
          </a>
          <ul class="dropdown-menu">
            <li>
              <a id="ar-aged-balance" href="#">AR Aged Balance</a>
            </li>
            <li>
              <a id="acme-detail-report" href="#">Acme Corp Detail</a>
            </li>
            <li>
              <a id="miami-invoice-detail" href="#">Miami Invoice Detail</a>
            </li>
          </ul>
        </li>
      </ul>
    </div>
    <hr/>
  
    <h1>Results</h1>
    <span id="pivot-detail"></span>
  
    <hr/>
    <div id="results"></div>
  </div>
<div>
  <div id="pivot-menu-container"></div>
  <div id="results"></div>
</div>
</div>


<!-- <div id="reportDiv">
  <br>
  <br>
  <h1>Here is the report generated by sbMACRO</h1>
  <br>
  <table class="table table-bordered table-striped" id="reportTable">
    <tr>
      <th>ID</th>
      <th>Object Type</th>
      <th>Name</th>
      <th>Fiscal Year</th>
      <th>Project</th>
      <th>Data in Project (GB)</th>
      <th>Data per File (KB)</th>
      <th>Total Data in Fiscal Year</th>
      <th>Running Data Total (GB)</th>
    </tr>
  </table>
  
</div> -->
<!-- <div id="missingDiv">

</div>
<div id="exceptionsDiv">

</div> 
<div>-->
  <!-- <p>beginning of script div</p> -->
  <script type="text/javascript">
    
    // console.log("Trying!")
    // var reportDict = {{ FullReportJson|safe }};
    // var reportStr = reportDict.report;
    // var missing = reportDict.missing;
    // var exceptions = reportDict.exceptions;
    // reportStr ? console.log('Exists!') : console.log('Doesn\'t exist!');
    // console.log(reportStr);
    // console.log("Missing: " + missing);
    // console.log("Exceptions: " + exceptions);
    // function test_func(reportStr) {
    //   console.log("reportStr: "+reportStr);
    // }
    // test_func(reportStr)

    // var report = reportStr;
    // console.log("report! "+report);
    // report = JSON && JSON.parse(reportStr) || $.parseJSON(reportStr); // This will ensure you use native JSON.parse immediately, rather than having jQuery perform sanity checks on the string before passing it to the native parsing function. https://stackoverflow.com/questions/4935632/parse-json-in-javascript
    
    

    //Doesn't work:
//    $(document).ready(function(report){
//      console.log("report1: "+report)
//      $(function(report){
//        console.log("report2: "+report) 
//        var report_data = '';
//        $.each(report, function(key, value){//somewhere in here there's a problem.
//          console.log("Key: "+key);
//          $each(key, function(key2, value2){
//            console.log("key2: "+key2);
//            report_data += '<tr>';
//            report_data += '<td>'+value.ID+'</td>';
//            report_data += '<td>'+value.ObjectType+'</td>';
//            report_data += '<td>'+value.name+'</td>';
//            report_data += '<td>'+value.FY+'</td>';
//            report_data += '<td>'+value.project+'</td>';
//            report_data += '<td>'+value.DataInProject+'</td>';
//            report_data += '<td>'+value.DataPerFile+'</td>';
//            report_data += '<td>'+value.totalFYData+'</td>';
//            report_data += '<td>'+value.RunningDataTotal+'</td>';
//            report_data += '</tr>';
//          });
//  
//        });
//        $('#reportTable').append(report_data);
//      });
//    });

    // $(document).ready(function (table){
    //   $("#reportDiv").addClass("Table"); //Adds the Table class from custom.css
    //   $("#reportDiv").append(table);
    //   var table = $("<table></table>"); //creates a table element
    //   var tr = $("<tr></tr>"); // creates a table row element
    //   var th = $("<th></th>"); // creates a table head cell element
    //   var td = $("<td></td>"); // creates a table data cell element
    //   for (var key in report) {
    //       if (report.hasOwnProperty(key)) {
    //         console.log("key: " + key);
    //         var th2 = $(th).text(key);
    //         $(table).append(th2);
    //         //console.log(table);
    //         var list = key[key];
    //         console.log("list?: " + list);
    //         for (var list2 in key) {
    //            console.log(list2);
    //         //   // var item = key[i];
    //         //   // console.log(item)

    //         //   // i = 0; i < key.length; i++){ 

    //         //   for (var item in list){
    //         //     var tr2 = $(table).append(tr);
    //         //     $(tr2).text(item);
    //         }
    //         //}
    //       }
    //     }
    //   console.log(table);
    // });
    
    //What I need to do now it this:
    /*
    Create a table with all the info in the json dynamically using javascript. 

    Have a button 'download report' that takes the json and creates an excel file (using some library) for download (using file-saverjs)

    In a div, 
      if report isn't empty
        create a column with a heading of the key 'ID'
          for each item in reports.ID, add it a row and add the contents to the first column
        create a column with a heading of the key 'Object Type'
          for each item in reports.ObjectType(?), add the contents to the corresponding row beginning with the second one (first one under the heading.)
        create a column with a heading of the key 'Name'
          for each item in reports.Name, add the contents to the corresponding row beginning with the second one (first one under the heading.)
        create a column with a heading of the key 'Fiscal Year'
          for each item in reports.FiscalYear(?), add the contents to the corresponding row beginning with the second one (first one under the heading.)
        create a column with a heading of the key 'Project'
          for each item in reports.Project, add the contents to the corresponding row beginning with the second one (first one under the heading.)
        create a column with a heading of the key 'Data in Project (GB)'
          for each item in reports['Data in Project (GB)'](?), add the contents to the corresponding row beginning with the second one (first one under the heading.)
        create a column with a heading of the key 'Data per File (KB)'
          for each item in reports['Data per File (KB)'], add the contents to the corresponding row beginning with the second one (first one under the heading.)
        create a column with a heading of the key 'Fiscal Year Total Data (GB)'
          for each item in reports['Fiscal Year total Data (GB)'], add the contents to the corresponding row beginning with the second one (first one under the heading.)
        create a column with a heading of the key 'Running Data Total (GB)'
          for each item in reports['Running Data Total (GB)'], add the contents to the corresponding row beginning with the second one (first one under the heading.)
      if missing doesn't equal 'None'
        create a new div under the previous div holding the report table
          create a new table with a header row
            create a column with the heading of the key 'Missing Data ID'
              for each item, create a row with the table data equal to the item.
            create a column with the heading of the key 'Missing Data URL'
              for each item, create a row with the table data equal to the item.
      if exceptions doesn't equal 'None'
        create a new div under the previous div holding either the report table or the missing table
          create a new table with a header row
            create a column with the heading of the key 'Exception/Permission Issue ID'
              for each item, create a row with the table data equal to the item.
            create a column with the heading of the key 'Exception/Permission Issue URL'
              for each item, create a row with the table data equal to the item.
              */
  </script>

{% endblock %}
