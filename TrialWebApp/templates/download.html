{% extends "base.html" %}
{% block content %}

<div id="reportDiv">
  <br>
  <br>
  <h1>Here is the report generated by sbMACRO</h1>
  
</div>
<div id="missingDiv">

</div>
<div id="exceptionsDiv">

</div>
<div>
  <p>beginning of script div</p>
  <script type="text/javascript">
    
    console.log("Trying!")
    var reportDict = {{ reportDict|safe }};
    var reportStr = reportDict.report;
    var missing = reportDict.missing;
    var exceptions = reportDict.exceptions;
    reportStr ? console.log('Exists!') : console.log('Doesn\'t exist!');
    console.log(reportStr);
    console.log("Missing: " + missing);
    console.log("Exceptions: " + exceptions);
    function test_func(reportStr) {
      console.log(reportStr);
    }
    test_func(reportStr)

    var report = reportStr;
    // report = JSON && JSON.parse(reportStr) || $.parseJSON(reportStr); // This will ensure you use native JSON.parse immediately, rather than having jQuery perform sanity checks on the string before passing it to the native parsing function. https://stackoverflow.com/questions/4935632/parse-json-in-javascript
    

    $(document).ready(function (table){
      $("#reportDiv").addClass("Table"); //Adds the Table class from custom.css
      $("#reportDiv").append(table);
      var table = $("<table></table>"); //creates a table element
      var tr = $("<tr></tr>"); // creates a table row element
      var th = $("<th></th>"); // creates a table head cell element
      var td = $("<td></td>"); // creates a table data cell element
      for (var key in report) {
          if (report.hasOwnProperty(key)) {
            console.log("key: " + key);
            var th2 = $(th).text(key);
            $(table).append(th2);
            //console.log(table);
            var list = key[key];
            console.log("list?: " + list);
            for (var list2 in key) {
               console.log(list2);
            //   // var item = key[i];
            //   // console.log(item)

            //   // i = 0; i < key.length; i++){ 

            //   for (var item in list){
            //     var tr2 = $(table).append(tr);
            //     $(tr2).text(item);
            }
            //}
          }
        }
      console.log(table);
    });
    
    //What I need to do now it this:
    /*
    Create a table with all the info in the json dynamically using javascript. 

    Have a button 'download report' that takes the json and creates an excel file (using some library) for download (using file-saverjs)

    In a div, 
      if report isn't empty
        create a column with a heading of the key 'ID'
          for each item in reports.ID, add it a row and add the contents to the first column
        create a column with a heading of the key 'Object Type'
          for each item in reports.ObjectType(?), add the contents to the corresponding row beginning with the second one (first one under the heading.)
        create a column with a heading of the key 'Name'
          for each item in reports.Name, add the contents to the corresponding row beginning with the second one (first one under the heading.)
        create a column with a heading of the key 'Fiscal Year'
          for each item in reports.FiscalYear(?), add the contents to the corresponding row beginning with the second one (first one under the heading.)
        create a column with a heading of the key 'Project'
          for each item in reports.Project, add the contents to the corresponding row beginning with the second one (first one under the heading.)
        create a column with a heading of the key 'Data in Project (GB)'
          for each item in reports['Data in Project (GB)'](?), add the contents to the corresponding row beginning with the second one (first one under the heading.)
        create a column with a heading of the key 'Data per File (KB)'
          for each item in reports['Data per File (KB)'], add the contents to the corresponding row beginning with the second one (first one under the heading.)
        create a column with a heading of the key 'Fiscal Year Total Data (GB)'
          for each item in reports['Fiscal Year total Data (GB)'], add the contents to the corresponding row beginning with the second one (first one under the heading.)
        create a column with a heading of the key 'Running Data Total (GB)'
          for each item in reports['Running Data Total (GB)'], add the contents to the corresponding row beginning with the second one (first one under the heading.)
      if missing doesn't equal 'None'
        create a new div under the previous div holding the report table
          create a new table with a header row
            create a column with the heading of the key 'Missing Data ID'
              for each item, create a row with the table data equal to the item.
            create a column with the heading of the key 'Missing Data URL'
              for each item, create a row with the table data equal to the item.
      if exceptions doesn't equal 'None'
        create a new div under the previous div holding either the report table or the missing table
          create a new table with a header row
            create a column with the heading of the key 'Exception/Permission Issue ID'
              for each item, create a row with the table data equal to the item.
            create a column with the heading of the key 'Exception/Permission Issue URL'
              for each item, create a row with the table data equal to the item.
              */
  </script>

{% endblock %}
